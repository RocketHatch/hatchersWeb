//var nodemailer = require('nodemailer');
var postmark = require("postmark")(process.env.POSTMARK_API_KEY);
//var config = require('config.json');

//config.mdbString;
/*var transport = nodemailer.createTransport("SMTP", {
    host: "test.com", //config.emailhost, // hostname
    secureConnection: true, // use SSL
    port: 465,  //port for secure SMTP
    auth: {
        user: "larry", //config.emailuser,
        pass: "password" //config.emailauth
    },
	debug: true
});*/

var subj = {'reset' : "Your Reset Request...",
            'newReg' : "Rocket Hatch Membership Confirmation"}

function send(to, subject, textstrs, response) {
  postmark.send({
    "From": "Hatchers@RocketHatch.com",
    "To": to,
	"Bcc": "lmason@HungryProgrammer.com",
    "Subject": subj[subject],
    "TextBody": textstrs[0],
    "Tag": "What is this...?"
  }, function(error, success) {
    if(error) {
      console.error("Unable to send via postmark: " + error.message);
      var rdata = JSON.stringify({"error":error});
	  response.writeHead(401, {"Content-Type": "application/json"});
      response.write(rdata);
      return;
    } else {
      console.info("Sent to postmark for delivery")
      var rdata = JSON.stringify(textstrs[1]);
	  response.writeHead(200, {"Content-Type": "application/json"});
      response.write(rdata);
    }
	response.end();
    //transport.close();	
  });
  //var mailOptions = {
  //  from: "The Rocket Hatch Team", //config.emailAdmin,
  //  to: to,
  //  subject: subj[subject],
  //  text: textstrs[0]
  //}
  /*
  transport.sendMail(mailOptions, function(error, result){
    if(error){
	  console.log("Send Message Error: " + error);
      var rdata = JSON.stringify({"error":error});
	  response.writeHead(401, {"Content-Type": "application/json"});
      response.write(rdata);
    }else{
	  var rdata = JSON.stringify(textstrs[1]);
	  response.writeHead(200, {"Content-Type": "application/json"});
      response.write(rdata);
    }
	response.end();
    transport.close();	
  });*/
}; 

exports.send = send;



