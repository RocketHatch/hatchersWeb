var nodemailer = require('nodemailer');
var config = require('config.json');

config.mdbString;
var transport = nodemailer.createTransport("SMTP", {
    host: config.emailhost, // hostname
    secureConnection: true, // use SSL
    port: 465, // port for secure SMTP
    auth: {
        user: config.emailuser,
        pass: config.emailauth
    },
	debug: true
});

function send(to, subject, text, response) {
  var mailOptions = {
    from: "rockethatch@designinghuntsville.com",
    to: to,
    subject: subject,
	text: text
  }
  transport.sendMail(mailOptions, function(error, result){
    if(error){
	  console.log("Send Message Error: " + error);
      var rdata = JSON.stringify({"error":error});
	  response.writeHead(401, {"Content-Type": "application/json"});
      response.write(rdata);
    }else{
	  var rdata = JSON.stringify({"message":"Check your email for instructions on resetting password"});
	  response.writeHead(200, {"Content-Type": "application/json"});
      response.write(rdata);
    }
	response.end();
    transport.close();	
  });
}; 

exports.send = send;