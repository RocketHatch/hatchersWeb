var nodemailer = require('nodemailer');
var config = require('config.json');

//config.mdbString;
var transport = nodemailer.createTransport("SMTP", {
    host: config.emailhost, // hostname
    secureConnection: true, // use SSL
    port: 465, // port for secure SMTP
    auth: {
        user: config.emailuser,
        pass: config.emailauth
    },
	debug: true
});

var subj = {'reset' : "Your Reset Request...",
            'newReg' : "Rocket Hatch Membership Confirmation"}

function send(to, subject, textstrs, response) {
  var mailOptions = {
    from: config.emailAdmin,
    to: to,
    subject: subj[subject],
	text: textstrs[0]
  }
  transport.sendMail(mailOptions, function(error, result){
    if(error){
	  console.log("Send Message Error: " + error);
      var rdata = JSON.stringify({"error":error});
	  response.writeHead(401, {"Content-Type": "application/json"});
      response.write(rdata);
    }else{
	  var rdata = JSON.stringify(textstrs[1]);
	  response.writeHead(200, {"Content-Type": "application/json"});
      response.write(rdata);
    }
	response.end();
    transport.close();	
  });
}; 

exports.send = send;